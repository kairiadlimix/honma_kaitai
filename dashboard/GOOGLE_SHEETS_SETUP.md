# Google Sheets セットアップガイド

## 1. Google Sheetsの準備

### 1.1 スプレッドシートの作成

1. Google Sheetsで新しいスプレッドシートを作成
2. 以下のシート（タブ）を作成：
   - **重機マスタ**
   - **稼働時間**
   - **メンテナンス**
   - **消耗品**

### 1.2 スプレッドシートIDの取得

スプレッドシートのURLからIDを取得：
```
https://docs.google.com/spreadsheets/d/[SPREADSHEET_ID]/edit
```

## 2. Google Cloud プロジェクトの設定

### 2.1 Google Cloud Consoleでプロジェクト作成

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. 新しいプロジェクトを作成
3. 「APIとサービス」→「ライブラリ」から「Google Sheets API」を有効化

### 2.2 サービスアカウントの作成

1. 「IAMと管理」→「サービスアカウント」を開く
2. 「サービスアカウントを作成」をクリック
3. サービスアカウント名を入力（例: `honma-kaitai-dashboard`）
4. 「作成して続行」をクリック
5. ロールは「編集者」を選択（または最小権限で「スプレッドシート編集者」）
6. 「完了」をクリック

### 2.3 サービスアカウントキーの作成

1. 作成したサービスアカウントをクリック
2. 「キー」タブを開く
3. 「キーを追加」→「新しいキーを作成」を選択
4. キーのタイプ: JSON
5. 「作成」をクリック（JSONファイルがダウンロードされる）

### 2.4 スプレッドシートの共有設定

1. Google Sheetsのスプレッドシートを開く
2. 「共有」ボタンをクリック
3. サービスアカウントのメールアドレス（JSONファイル内の`client_email`）を入力
4. 権限: 「編集者」を選択
5. 「送信」をクリック

## 3. 環境変数の設定

`.env.local`ファイルに以下を追加：

```env
# Google Sheets
GOOGLE_SHEETS_ID="your-spreadsheet-id"
GOOGLE_SERVICE_ACCOUNT_EMAIL="your-service-account@project.iam.gserviceaccount.com"
GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
```

**注意**: 
- `GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY`は、JSONファイルの`private_key`フィールドの値をそのまま設定
- 改行文字（`\n`）はそのまま含める

## 4. スプレッドシートのデータ形式

### 4.1 重機マスタシート

| 管理番号 | シリアル番号 | メーカー | 重機クラス | 型式 | 年式 | 購入年月日 | 特自検期限 | ステータス |
|---------|------------|---------|----------|------|------|-----------|-----------|-----------|
| SK-001  | SK123456   | コベルコ | SK235    | ...  | 2018 | 2018/04/01 | 2024/12/31 | 稼働中    |
| ZX-001  | ZX789012   | 日立     | ZX200    | ...  | 2019 | 2019/06/15 | 2024/11/30 | 稼働中    |

**1行目はヘッダー行として使用**

### 4.2 稼働時間シート

| 管理番号 | 日付       | 稼働時間 | アイドリング時間 | 累計稼働時間 |
|---------|-----------|---------|----------------|------------|
| SK-001  | 2024/01/15 | 8.5     | 1.0            | 5200       |
| SK-001  | 2024/01/16 | 7.0     | 0.5            | 5207.5     |

### 4.3 メンテナンスシート

| メンテナンスID | 管理番号 | 実施日     | メンテナンス種別 | コスト   | 実施内容 |
|--------------|---------|-----------|----------------|---------|---------|
| MT-001       | SK-001  | 2024/01/15 | 特自検         | 50000   | ...     |
| MT-002       | SK-001  | 2024/01/10 | オイル交換     | 15000   | ...     |

### 4.4 消耗品シート

| 管理番号 | 消耗品種別 | 使用日     | 使用量 | 単位 | 単価 | 総コスト |
|---------|----------|-----------|--------|------|------|---------|
| SK-001  | オイル    | 2024/01/10 | 20     | L    | 800  | 16000   |
| SK-001  | フィルター | 2024/01/10 | 2      | 個   | 2000 | 4000    |

## 5. サンプルデータの準備

PoC用のサンプルデータをGoogle Sheetsに入力してください。

**推奨データ量**:
- 重機マスタ: 15〜20台
- 稼働時間: 過去6ヶ月分（各重機）
- メンテナンス: 過去6ヶ月分（各重機、月1〜2回程度）
- 消耗品: 過去6ヶ月分（各重機、月1〜2回程度）

## 6. 動作確認

1. 開発サーバーを起動: `pnpm dev`
2. ブラウザで `http://localhost:3000` を開く
3. ダッシュボードが表示され、データが読み込まれることを確認

## 7. トラブルシューティング

### エラー: "GOOGLE_SHEETS_ID is not set"
- `.env.local`に`GOOGLE_SHEETS_ID`が設定されているか確認

### エラー: "The caller does not have permission"
- サービスアカウントにスプレッドシートの共有権限が付与されているか確認
- サービスアカウントのメールアドレスが正しいか確認

### エラー: "Invalid credentials"
- `GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY`の値が正しいか確認
- 改行文字（`\n`）が含まれているか確認

